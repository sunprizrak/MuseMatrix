#:import EditImageScreen screens.edit_image
#:import EditImage widgets.EditImage
#:import DrawWidget widgets.EditImage

<EditImageScreen>
    name: 'edit_image_screen'

    prompt: input_prompt.text

    MDFloatLayout:
        id: edit_layout

        MDBoxLayout:
            id: layout
            orientation: 'vertical'

            MDTopAppBar:
                id: edit_top_bar
                type: 'small'
                md_bg_color: self.theme_cls.backgroundColor

                MDTopAppBarLeadingButtonContainer:

                    MDActionTopAppBarButton:
                        icon: 'arrow-left-bold'
                        ripple_effect: False
                        focus_behavior: False
                        on_release: app.back(screen='main_screen') if not root.flag_section else root.back_section()

                MDTopAppBarTitle:
                    text: 'edit image'
                    theme_font_name: "Custom"
                    font_name: 'Hacked'

            MDFloatLayout:
                id: image_edit_section

                MDFabButton:
                    id: add_image_button
                    icon: 'image-plus'
                    style: 'large'
                    theme_font_size: "Custom"
                    font_size: sp(58)
                    opacity: 0 if self.disabled else 1
                    pos_hint: {"center_x": .5, 'center_y': .55}
                    on_release:
                        app.file_manager_open()

                MDBoxLayout:
                    orientation: 'vertical'

                    MDBoxLayout:
                        id: image_box

                    MDBoxLayout:
                        id: bottom_buttons
                        orientation: 'horizontal'
                        padding: dp(10)
                        spacing: dp(20)
                        pos_hint: {'center_x': .5}
                        buttons_disabled: True
                        adaptive_height: True

                        MDBoxLayout:
                            orientation: 'horizontal'
                            spacing: dp(10)
                            adaptive_height: True

                            MDFabButton:
                                icon: 'broom'
                                style: 'small'
                                disabled: bottom_buttons.buttons_disabled
                                opacity: 0 if self.disabled else 1
                                on_release:
                                    root.clear_selection()

                            MDFabButton:
                                icon: 'image-sync'
                                style: 'small'
                                disabled: bottom_buttons.buttons_disabled
                                opacity: 0 if self.disabled else 1
                                on_release:
                                    root.reload_image()

                            MDSlider:
                                id: erase_percent
                                min: 0
                                max: 10
                                step: 1
                                value: 4

                                size_hint: None, None
                                width: dp(150)
                                height: dp(40)
                                disabled: bottom_buttons.buttons_disabled
                                opacity: 0 if self.disabled else 1

                                MDSliderHandle:

                                MDSliderValueLabel:

                        MDButton:
                            style: 'elevated'
                            radius: dp(10)
                            disabled: bottom_buttons.buttons_disabled
                            opacity: 0 if self.disabled else 1
                            pos_hint: {'center_x': .8}
                            on_release: root.next_section() if not self.disabled else None

                            MDButtonText:
                                text: 'next'
                                theme_font_name: 'Custom'
                                font_name: 'Hacked'
            MDBoxLayout:
                id: option_section
                orientation: 'vertical'
                spacing: dp(10)

                MDBoxLayout:
                    orientation: 'horizontal'
                    adaptive_height: True
                    size_hint_x: .9
                    pos_hint: {'center_x': .5}
                    spacing: dp(40)

                    MDLabel:
                        text: 'quantity:'
                        theme_font_size: 'Custom'
                        font_size: sp(35)
                        theme_font_name: "Custom"
                        font_name: 'Hacked'
                        valign: 'center'
                        adaptive_size: True

                    MDBoxLayout:
                        orientation: 'horizontal'
                        pos_hint: {'center_x': .5}
                        size_hint_x: None
                        width: dp(140)
                        adaptive_height: True

                        MDIconButton:
                            icon: 'minus-box-outline'
                            theme_font_size: "Custom"
                            font_size: sp(30)
                            ripple_effect: False
                            focus_behavior: False
                            theme_icon_color: "Custom"
                            icon_color: app.theme_cls.secondaryContainerColor
                            on_release:
                                root.image_count -= 1

                        MDLabel:
                            id: img_count
                            text: str(root.image_count)
                            theme_font_name: "Custom"
                            font_name: 'Hacked'
                            theme_font_size: 'Custom'
                            font_size: sp(30)
                            halign: 'center'


                        MDIconButton:
                            icon: 'plus-box-outline'
                            theme_font_size: "Custom"
                            font_size: sp(30)
                            ripple_effect: False
                            focus_behavior: False
                            theme_icon_color: "Custom"
                            icon_color: app.theme_cls.secondaryContainerColor
                            on_release:
                                root.image_count += 1

                MDBoxLayout:

                    TextInput:
                        id: input_prompt
                        multiline: True
                        auto_indent: True
                        padding: dp(10)
                        border: [2, 2, 2, 2]
                        cursor_color: app.theme_cls.secondaryContainerColor
                        cursor_width: sp(3)
                        font_size: sp(17)
                        hint_text: 'Enter the prompt'
                        pos_hint: {'center_x': .5}

                MDBoxLayout:
                    adaptive_height: True

                    MDButton:
                        style: 'elevated'
                        theme_width: 'Custom'
                        size_hint_x: 1
                        radius: dp(0)
                        on_release:
                            root.edit_image()

                        MDButtonText:
                            text: 'Generate'
                            pos_hint: {'center_x': .5}
                            theme_text_color: 'Custom'
                            text_color: 'white'
                            theme_font_name: 'Custom'
                            font_name: 'Hacked'
                            font_style: 'Display'
                            role: 'small'

        MDCircularProgressIndicator:
            id: edit_spin
            size_hint: None, None
            size: dp(38), dp(38)
            pos_hint: {'center_x': .5, 'center_y': .5}
            active: False